"use strict";(self.webpackChunksuse_edge_docs=self.webpackChunksuse_edge_docs||[]).push([[3584],{8208:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var s=i(5893),t=i(1151);const a={sidebar_position:3,title:"Standalone Clusters with Edge Image Builder"},r=void 0,l={id:"quickstart/eib",title:"Standalone Clusters with Edge Image Builder",description:"What is the Edge Image Builder?",source:"@site/docs/quickstart/eib.mdx",sourceDirName:"quickstart",slug:"/quickstart/eib",permalink:"/docs/quickstart/eib",draft:!1,unlisted:!1,editUrl:"https://github.com/suse-edge/suse-edge.github.io/tree/main/docs/quickstart/eib.mdx",tags:[],version:"current",lastUpdatedBy:"Andrew Gracey",lastUpdatedAt:1707758273,formattedLastUpdatedAt:"Feb 12, 2024",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"Standalone Clusters with Edge Image Builder"},sidebar:"docs",previous:{title:"SLE Micro on X86_64 on libvirt (virt-install)",permalink:"/docs/demo_setup/slemicro-virt-install-x86_64"},next:{title:"BMC automated deployments with Metal3",permalink:"/docs/quickstart/metal3"}},o={},d=[{value:"What is the Edge Image Builder?",id:"what-is-the-edge-image-builder",level:2},{value:"Why use this method",id:"why-use-this-method",level:2},{value:"How to use the Edge Image Builder",id:"how-to-use-the-edge-image-builder",level:2},{value:"Directory structure",id:"directory-structure",level:3},{value:"Building the config file",id:"building-the-config-file",level:3},{value:"Users",id:"users",level:4},{value:"Packages",id:"packages",level:4},{value:"Network Configuration",id:"network-configuration",level:4},{value:"Running the image build",id:"running-the-image-build",level:3},{value:"Using your newly built image",id:"using-your-newly-built-image",level:3},{value:"Updating your system while airgapped",id:"updating-your-system-while-airgapped",level:3},{value:"Next steps",id:"next-steps",level:2},{value:"Planned changes",id:"planned-changes",level:2},{value:"Additional Resources",id:"additional-resources",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"what-is-the-edge-image-builder",children:"What is the Edge Image Builder?"}),"\n",(0,s.jsx)(n.p,{children:"The Edge Image Builder is a tool that allows for generating a fully customized disk image for installing and bootstrapping nodes without the usual pain and suffering."}),"\n",(0,s.jsx)(n.p,{children:"It supports a variety of configuration options including (but not limited to):"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Users, passwords, and ssh-keys"}),"\n",(0,s.jsx)(n.li,{children:"Kernel command line arguments"}),"\n",(0,s.jsx)(n.li,{children:"Systemd-services to be enabled/disabled at boot-time"}),"\n",(0,s.jsx)(n.li,{children:"Configuration of Network Devices (static IP, hostname, VLAN\u2019s, bonding, etc.)"}),"\n",(0,s.jsx)(n.li,{children:"Airgapped installation of host-level packages (including dependency resolution)"}),"\n",(0,s.jsx)(n.li,{children:"Standard system configuration (e.g. proxies, NTP, custom SSL certificates, etc.)"}),"\n",(0,s.jsx)(n.li,{children:"Registration to Rancher via Elemental API"}),"\n",(0,s.jsx)(n.li,{children:"Registration to SUSE Manager for OS management"}),"\n",(0,s.jsx)(n.li,{children:"Fallback for custom scripts that enables any manual tasks"}),"\n",(0,s.jsx)(n.li,{children:"Fully air-gapped deployments of Kubernetes (single & multi-node deployments)"}),"\n",(0,s.jsx)(n.li,{children:"Fully air-gapped workload management (enabling customer images & manifests)"}),"\n",(0,s.jsx)(n.li,{children:"Fully unattended node deployment"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"why-use-this-method",children:"Why use this method"}),"\n",(0,s.jsx)(n.p,{children:"While the Edge Image Builder tool is a part of the process from all three provisioning methods, it really shows it's value in scenarios where the clusters being deployed have limited networking or are fully air-gapped."}),"\n",(0,s.jsx)(n.h2,{id:"how-to-use-the-edge-image-builder",children:"How to use the Edge Image Builder"}),"\n",(0,s.jsxs)(n.p,{children:["Edge Image Builder is typically run from inside a container so, if you don't already have a way to run containers, we need to start by installing a container runtime such as ",(0,s.jsx)(n.a,{href:"https://podman.io",children:"Podman"})," or ",(0,s.jsx)(n.a,{href:"https://rancherdesktop.io",children:"Rancher Desktop"}),". For this guide, we will assume you already have a container runtime available."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["If you are running Rancher Desktop, you need to switch to the ",(0,s.jsxs)(n.a,{href:"https://docs.rancherdesktop.io/ui/preferences/container-engine/general",children:[(0,s.jsx)(n.code,{children:"dockerd (moby)"})," container runtime"]})]})}),"\n",(0,s.jsx)(n.h3,{id:"directory-structure",children:"Directory structure"}),"\n",(0,s.jsx)(n.p,{children:"When running the tool, we will mount in a directory from the host."}),"\n",(0,s.jsxs)(n.p,{children:["This directory has the following structure (all subdirectories other than ",(0,s.jsx)(n.code,{children:"images"})," are optional):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"./\n\u251c\u2500\u2500 eib-config-iso.yaml\n\u251c\u2500\u2500 base-images/\n\u2502   \u2514 SLE-Micro.x86_64-5.5.0-Default-SelfInstall-GM.install.iso\n\u251c\u2500\u2500 network/\n\u251c\u2500\u2500 rpms/\n\u251c\u2500\u2500 elemental/\n\u2514\u2500\u2500 custom/\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["For this quickstart, we will be ignoring the elemental subdirectory. If you are working with Elemental, please check out it's ",(0,s.jsx)(n.a,{href:"/docs/quickstart/elemental",children:"quickstart guide"})," for more information!"]})}),"\n",(0,s.jsx)(n.h3,{id:"building-the-config-file",children:"Building the config file"}),"\n",(0,s.jsx)(n.p,{children:"The config file is where we define what changes need to be included in your environment."}),"\n",(0,s.jsx)(n.p,{children:"The base contents of the file are:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: 1.0\nimage:\n    imageType: iso\n    arch: x86_64\n    baseImage: SLE-Micro.x86_64-5.5.0-Default-SelfInstall-GM.install.iso\n    outputImageName: eib-image.iso\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Let's save this file as ",(0,s.jsx)(n.code,{children:"iso-config.yaml"})]}),"\n",(0,s.jsx)(n.h4,{id:"users",children:"Users"}),"\n",(0,s.jsx)(n.p,{children:"The first thing we can add are users of the system. Let's say we want to include a password for the root user (which is not typically a good idea for production but it makes a good demo)."}),"\n",(0,s.jsx)(n.p,{children:"First, we need to encrypt the password using:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"openssl passwd -6 MyPassword!123\n"})}),"\n",(0,s.jsx)(n.p,{children:"This will output something similar to:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$6$UrXB1sAGs46DOiSq$HSwi9GFJLCorm0J53nF2Sq8YEoyINhHcObHzX2R8h13mswUIsMwzx4eUzn/rRx0QPV4JIb0eWCoNrxGiKH4R31\n"})}),"\n",(0,s.jsxs)(n.p,{children:["We can then add a section in the config file called ",(0,s.jsx)(n.code,{children:"operatingSystem"})," with a ",(0,s.jsx)(n.code,{children:"users"})," array inside it. The resulting file should look like:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: 1.0\nimage:\n    imageType: iso\n    baseImage: SLE-Micro.x86_64-5.5.0-Default-SelfInstall-GM.install.iso\n    outputImageName: eib-image.iso\noperatingSystem:\n    users:\n    - username: root\n      encryptedPassword: $6$UrXB1sAGs46DOiSq$HSwi9GFJLCorm0J53nF2Sq8YEoyINhHcObHzX2R8h13mswUIsMwzx4eUzn/rRx0QPV4JIb0eWCoNrxGiKH4R31\n"})}),"\n",(0,s.jsx)(n.h4,{id:"packages",children:"Packages"}),"\n",(0,s.jsx)(n.p,{children:"Let's extend our image a bit with some additional packages."}),"\n",(0,s.jsxs)(n.p,{children:["For an example in this quickstart, let's say you were still testing stuff locally and wanted to install the ",(0,s.jsx)(n.code,{children:"yq"})," command to make working with yaml easier. This package can be found in the PackageHub repo."]}),"\n",(0,s.jsx)(n.p,{children:"To have this package installed, we can add a section to the"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: 1.0\nimage:\n    imageType: iso\n    baseImage: SLE-Micro.x86_64-5.5.0-Default-SelfInstall-GM.install.iso\n    outputImageName: eib-image.iso\noperatingSystem:\n    users:\n    - username: root\n      encryptedPassword: $6$UrXB1sAGs46DOiSq$HSwi9GFJLCorm0J53nF2Sq8YEoyINhHcObHzX2R8h13mswUIsMwzx4eUzn/rRx0QPV4JIb0eWCoNrxGiKH4R31\n  packages:\n    packageList:\n    - yq\n    additionalRepos:\n    - https://updates.suse.com/SUSE/Backports/SLE-15-SP5_x86_64/standard\n    #registrationCode: INTERNAL-USE-ONLY-foo-bar\n"})}),"\n",(0,s.jsx)(n.p,{children:"TODO: this isn't working"}),"\n",(0,s.jsx)(n.p,{children:"This will look through the requested packages, collect all the dependencies, pull the required rpms, and include them on the image to be installed without needing to connect to the network."}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["More Operating System settings can be found ",(0,s.jsx)(n.a,{href:"https://github.com/suse-edge/edge-image-builder/blob/main/docs/building-images.md#operating-system",children:"here in the Edge Image Builder documentation"})]})}),"\n",(0,s.jsx)(n.h4,{id:"network-configuration",children:"Network Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Lastly, for this quickstart example, let's setup a network device!"}),"\n",(0,s.jsxs)(n.p,{children:["This is done by adding a file in the ",(0,s.jsx)(n.code,{children:"network"})," subdirectory called ",(0,s.jsx)(n.code,{children:"host1.local.yaml"})," with the contents:"]}),"\n",(0,s.jsx)(n.p,{children:"//TODO: what's the minimum needed, and do we really need to specify the MAC address?"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"dns-resolver: {}\nroutes:\n  running:\n    - destination: 0.0.0.0/0\n      next-hop-interface: eth0\n      next-hop-address: 192.168.1.1\n      table-id: 254\n  config: []\ninterfaces:\n  - name: eth0\n    type: ethernet\n    state: up\n    mac-address: 0E:4D:C6:B8:C4:72\n    ipv4:\n      enabled: true\n      address:\n        - ip: 192.168.1.99\n          prefix-length: 24\n    ethernet:\n      auto-negotiation: false\n  - name: lo\n    type: loopback\n    state: up\n    mac-address: 00:00:00:00:00:00\n    mtu: 65536\n    ipv4:\n      enabled: true\n      address:\n        - ip: 127.0.0.1\n          prefix-length: 8\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will be turned into the needed ",(0,s.jsx)(n.a,{href:"https://github.com/nmstate/nmstate",children:"nmstate"})," configuration files when the image is built."]}),"\n",(0,s.jsx)(n.h3,{id:"running-the-image-build",children:"Running the image build"}),"\n",(0,s.jsx)(n.p,{children:"To build the image, we can run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it -v $PWD/eib/:/eib registry.opensuse.org/home/atgracey/eib/container/containerfile/eib:latest /usr/bin/eib -config-file eib-config.yaml -config-dir /eib -build-dir /eib/_build\n"})}),"\n",(0,s.jsx)(n.p,{children:"TODO: Change the image to the released version when available"}),"\n",(0,s.jsxs)(n.p,{children:["This will create a timestamped folder in ",(0,s.jsx)(n.code,{children:"$PWD/eib/_build/"})," that includes the produced iso image (called ",(0,s.jsx)(n.code,{children:"eib-image.iso"}),")"]}),"\n",(0,s.jsx)(n.h3,{id:"using-your-newly-built-image",children:"Using your newly built image"}),"\n",(0,s.jsx)(n.p,{children:"We can use this new image by burning it to a USB drive."}),"\n",(0,s.jsx)(n.p,{children:"// TODO: add tabs for each OS"}),"\n",(0,s.jsx)(n.h3,{id:"updating-your-system-while-airgapped",children:"Updating your system while airgapped"}),"\n",(0,s.jsx)(n.p,{children:"// TODO: ???"}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,s.jsx)(n.p,{children:"Due to how many configuration options the Edge Image Builder offers, a quickstart that goes through all of them would not be easily readable. Here are some links to commonly needed configurations options:"}),"\n",(0,s.jsx)(n.p,{children:"// TODO: add links"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Systemd-services"}),"\n",(0,s.jsx)(n.li,{children:"Registration with SUSE Manager"}),"\n",(0,s.jsx)(n.li,{children:"Airgapped container side-loading"}),"\n",(0,s.jsx)(n.li,{children:"Kubernetes deployment"}),"\n",(0,s.jsx)(n.li,{children:"???"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"planned-changes",children:"Planned changes"}),"\n",(0,s.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,s.jsx)(n.p,{children:"//TODO: what should be here"})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>l,a:()=>r});var s=i(7294);const t={},a=s.createContext(t);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);